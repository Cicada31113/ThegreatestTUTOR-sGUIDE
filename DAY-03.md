# Python ì‹¤í–‰ ì›ë¦¬ & ë™ì‹œì„±(í”„ë¡œì„¸ìŠ¤/ìŠ¤ë ˆë“œ) ì‹¬í™” ë…¸íŠ¸

> ì˜¤ëŠ˜ ê°•ì˜ í•„ê¸° ì •ë¦¬ë³¸ (ë³´ì™„/ìˆ˜ì • í¬í•¨).  
> ì¸í„°í”„ë¦¬í„° vs ì»´íŒŒì¼ëŸ¬, CPython ë™ì‘ ë°©ì‹, í”„ë¡œì„¸ìŠ¤Â·ìŠ¤ë ˆë“œ, í™/ìŠ¤íƒ, GIL, ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­, ì„ê³„êµ¬ì—­/ë½, ì‘ì—… ë¶„í•  ì „ëµê¹Œì§€.

---

## ëª©ì°¨
1. [ì¸í„°í”„ë¦¬í„° vs ì»´íŒŒì¼ëŸ¬ (í•µì‹¬ ë¹„êµ)](#sec-1)
2. [CPythonì€ ì–´ë–»ê²Œ ì‹¤í–‰ë˜ëŠ”ê°€ (ë°”ì´íŠ¸ì½”ë“œÂ·ê°€ìƒë¨¸ì‹ Â·sys/linecache)](#sec-2)
3. [í”„ë¡œì„¸ìŠ¤ ì‘ë™ ì›ë¦¬ (current_process, getpid, start/join, target/args)](#sec-3)
4. [ìŠ¤ë ˆë“œ: ì‹¤íƒ€ë˜ ë¹„ìœ , ì¥ë‹¨ì Â·í•œê³„, `_`(ì–¸ë”ìŠ¤ì½”ì–´) ì˜ë¯¸](#sec-4)
5. [ìŠ¤íƒ í”„ë ˆì„ vs í™: ë¬´ì—‡ì´ ê³µìœ ë˜ê³  ë¬´ì—‡ì´ ë¶„ë¦¬ë˜ëŠ”ê°€](#sec-5)
6. [CPU-bound vs I/O-bound, Executors, asyncio, GIL, ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­](#sec-6)
7. [ì‘ì—…ì„ ë„ˆë¬´ ì˜ê²Œ ìª¼ê°œë©´ ì™œ ëŠë ¤ì§€ë‚˜ (ì˜¤ë²„í—¤ë“œ, ëŒ€ì•ˆ ì „ëµ)](#sec-7)
8. [ì„ê³„êµ¬ì—­ê³¼ Lock: race vs safe, `with lock`ì˜ ì‹¤ì œ ë™ì‘](#sec-8)
9. [GILì€ ì–¸ì œ/ì™œ í•´ì œë˜ëŠ”ê°€: `time.sleep`ì´ ì£¼ëŠ” íš¨ê³¼](#sec-9)

---

<a id="sec-1"></a>
## 1. ì¸í„°í”„ë¦¬í„° vs ì»´íŒŒì¼ëŸ¬ (í•µì‹¬ ë¹„êµ)

### ğŸ¯ í•™ìŠµ í¬ì¸íŠ¸
- ë‘ ì‹¤í–‰ ëª¨ë¸ì˜ ì°¨ì´ë¥¼ **ì‹¤í–‰ ì‹œì /ì‚°ì¶œë¬¼/ì„±ëŠ¥/ë””ë²„ê¹…** ê´€ì ì—ì„œ ë¹„êµ.
- â€œíŒŒì´ì¬ì€ ì¸í„°í”„ë¦¬í„° ì–¸ì–´â€ ë¼ëŠ” ë§ì˜ ì •í™•í•œ ì˜ë¯¸ë¥¼ ì¡ëŠ”ë‹¤.

### ğŸ“– ê°œë… ì •ë¦¬
| êµ¬ë¶„ | ì»´íŒŒì¼ëŸ¬(ì˜ˆ: C/C++) | ì¸í„°í”„ë¦¬í„°(ì˜ˆ: Python/JS) |
|---|---|---|
| ì‹¤í–‰ ì „ ë³€í™˜ | ì „ì²´ ì†ŒìŠ¤ë¥¼ **ê¸°ê³„ì–´**ë¡œ ë³€í™˜(ë¹Œë“œ) | **ì¤„ ë‹¨ìœ„/ë¸”ë¡ ë‹¨ìœ„**ë¡œ í•´ì„í•˜ë©° ë°”ë¡œ ì‹¤í–‰ |
| ì‚°ì¶œë¬¼ | ì‹¤í–‰ íŒŒì¼(ë˜ëŠ” ë°”ì´ë„ˆë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬) | ë³„ë„ ì‹¤í–‰ íŒŒì¼ ì—†ìŒ(íŒŒì´ì¬ ëŸ°íƒ€ì„ì´ í•„ìš”) |
| ì„±ëŠ¥ | ëŒ€ì²´ë¡œ **ë¹ ë¦„**(ë¯¸ë¦¬ ìµœì í™”) | **ìƒëŒ€ì ìœ¼ë¡œ ëŠë¦¼**(ë§¤ ì‹¤í–‰ ì‹œ í•´ì„) |
| ë””ë²„ê¹…/ê°œë°œ | ë¹Œë“œ í•„ìš”(í”¼ë“œë°± ë£¨í”„ ê¸¸ì–´ì§€ê¸° ì‰¬ì›€) | ì¦‰ì‹œ ì‹¤í–‰/ë¹ ë¥¸ ì‹¤í—˜Â·ë””ë²„ê¹…ì— ìœ ë¦¬ |
| ë°°í¬ | ëŸ°íƒ€ì„ ì—†ì´ ë°°í¬ ê°€ëŠ¥(ëŒ€ì²´ë¡œ) | ëŸ°íƒ€ì„ í•„ìš”(CPython ë“± ì¸í„°í”„ë¦¬í„°) |

> ì£¼ì˜: â€œíŒŒì´ì¬=ìˆœìˆ˜ ì¸í„°í”„ë¦¬íŠ¸ë§Œ í•œë‹¤â€ëŠ” ì˜¤í•´ê°€ ë§ë‹¤. **CPythonì€ ë‚´ë¶€ì ìœ¼ë¡œ ë°”ì´íŠ¸ì½”ë“œë¡œ â€œì»´íŒŒì¼â€** í›„ **ê°€ìƒë¨¸ì‹ ì´ ì¸í„°í”„ë¦¬íŠ¸**í•œë‹¤. (2ë²ˆì—ì„œ ìƒì„¸)

---

<a id="sec-2"></a>
## 2. CPythonì€ ì–´ë–»ê²Œ ì‹¤í–‰ë˜ëŠ”ê°€ (ë°”ì´íŠ¸ì½”ë“œÂ·ê°€ìƒë¨¸ì‹ Â·sys/linecache)

### ğŸ“Œ ì‹¤ìŠµ ì½”ë“œ: í•œ ì¤„ ì‹¤í–‰ íë¦„ ì¶”ì 
```python
import sys, linecache

def trace(frame, event, arg):
    if event == "line":
        co = frame.f_code          # ì½”ë“œ ê°ì²´
        lineno = frame.f_lineno    # í˜„ì¬ ì¤„ ë²ˆí˜¸
        src = linecache.getline(co.co_filename, lineno).strip()
        print(f"Tracing {co.co_name} at line {lineno}: {src}")
    return trace  # ê³„ì† ì¶”ì í•˜ë ¤ë©´ íŠ¸ë ˆì´ìŠ¤ í•¨ìˆ˜ë¥¼ ê·¸ëŒ€ë¡œ ë°˜í™˜

def add(x, y):
    z = x + y
    return z

if __name__ == "__main__":
    sys.settrace(trace)            # ì „ì—­ íŠ¸ë ˆì´ìŠ¤ í›… ì„¤ì¹˜
    a = 10
    b = 20
    print("Result of add:", add(a, b))
```

### ğŸ¯ í•™ìŠµ í¬ì¸íŠ¸
- **CPython íŒŒì´í”„ë¼ì¸**: ì†ŒìŠ¤ â†’ íŒŒì„œ/AST â†’ **ë°”ì´íŠ¸ì½”ë“œ**(.pyc ìºì‹œ) â†’ **ê°€ìƒë¨¸ì‹ (í‰ê°€ ë£¨í”„)**.
- `sys.settrace`ë¡œ **ì¤„ ë‹¨ìœ„ ì´ë²¤íŠ¸**ë¥¼ ê´€ì°°í•˜ì—¬ â€œì¸í„°í”„ë¦¬íŠ¸ë˜ëŠ” ëŠë‚Œâ€ì„ ì²´ê°.
- `linecache`ë¡œ **íŒŒì¼ì˜ íŠ¹ì • ì¤„**ì„ ì•ˆì „í•˜ê²Œ ì½ì–´ ì„¤ëª… ë©”ì‹œì§€ êµ¬ì„±.

### ğŸ“– ê°œë…Â·ëª¨ë“ˆ ì„¤ëª…
- **CPython**: í‘œì¤€ íŒŒì´ì¬ êµ¬í˜„ì²´. ì†ŒìŠ¤ë¥¼ **ë°”ì´íŠ¸ì½”ë“œë¡œ ì»´íŒŒì¼** í›„ **ë°”ì´íŠ¸ì½”ë“œë¥¼ ì¸í„°í”„ë¦¬íŠ¸**í•œë‹¤. `__pycache__/ëª¨ë“ˆëª….cpython-xy.pyc` ìºì‹œ ì‚¬ìš©.
- **`sys.settrace(callable)`**: CPythonì´ **í•¨ìˆ˜ í˜¸ì¶œ/ì¤„ ì‹¤í–‰/ì˜ˆì™¸** ë“± ì´ë²¤íŠ¸ë§ˆë‹¤ ì½œë°±ì„ í˜¸ì¶œí•˜ê²Œ í•¨. ë””ë²„ê±°/ì»¤ë²„ë¦¬ì§€ ë„êµ¬ì˜ ê¸°ë°˜.
- **`linecache.getline(path, lineno)`**: íŒŒì¼ì„ ë§¤ë²ˆ ì—´ì§€ ì•Šê³  **ìºì‹œ**ì—ì„œ íŠ¹ì • ì¤„ì„ ê°€ì ¸ì˜´.

### âš ï¸ ì£¼ì˜Â·íŒ
- íŠ¸ë ˆì´ìŠ¤ëŠ” **ì˜¤ë²„í—¤ë“œê°€ í¼**. ì‹¤ì„œë¹„ìŠ¤ ì½”ë“œì— ìƒì‹œ ì¼œë‘ì§€ ë§ ê²ƒ.
- íŒŒì´ì¬ í”„ë¡œê·¸ë¨ì€ â€œì¸í„°í”„ë¦¬íŠ¸ ì–¸ì–´â€ë¼ ë¶ˆë¦¬ì§€ë§Œ, **ì‹¤ì œë¡  â€˜ì»´íŒŒì¼(ë°”ì´íŠ¸ì½”ë“œ) + ì¸í„°í”„ë¦¬íŠ¸â€™ í˜¼í•© ëª¨ë¸**ì„.

---

<a id="sec-3"></a>
## 3. í”„ë¡œì„¸ìŠ¤ ì‘ë™ ì›ë¦¬ (current_process, getpid, start/join, target/args)

### ğŸ“Œ ë³´ì •ëœ ì‹¤ìŠµ ì½”ë“œ
```python
from multiprocessing import Process, current_process
import os, time

def work(n):
    # ìì‹ í”„ë¡œì„¸ìŠ¤ì˜ ë¬¸ë§¥: ê³ ìœ  PID/ì´ë¦„, ì¸ì n í™•ì¸
    print(f"[child] pid={os.getpid()}, name={current_process().name}, arg={n}")
    time.sleep(1)

if __name__ == "__main__":
    print(f"[parent] pid={os.getpid()}, name={current_process().name}")

    ps = [Process(target=work, args=(i,), name=f"p{i}") for i in range(3)]
    for p in ps:
        p.start()    # ğŸŸ¢ ìƒˆ í”„ë¡œì„¸ìŠ¤ë¥¼ ì‹¤ì œë¡œ ì‹œì‘ (spawn/fork)
    for p in ps:
        p.join()     # ğŸŸ¢ ìì‹ ì¢…ë£Œê¹Œì§€ ë¶€ëª¨ê°€ ëŒ€ê¸° (ì •ë¦¬/ë™ê¸°í™”)
```

### ğŸ¯ í•™ìŠµ í¬ì¸íŠ¸
- **í”„ë¡œì„¸ìŠ¤ = ë…ë¦½ ì£¼ì†Œ ê³µê°„ + ê³ ìœ  PID**. ë¶€ëª¨/ìì‹ì€ ë©”ëª¨ë¦¬ë¥¼ **ê³µìœ í•˜ì§€ ì•ŠëŠ”ë‹¤**.
- `start()`ê°€ ìˆì–´ì•¼ **ìì‹ì´ ì‹¤ì œë¡œ ì‹¤í–‰**ëœë‹¤. `join()`ì€ **ë¶€ëª¨ê°€ ëŒ€ê¸°**í•˜ëŠ” ë™ê¸°í™” ì§€ì .

### ğŸ“– í‚¤ API ì„¤ëª…
- **`multiprocessing.current_process()`**: í˜„ì¬ ì‹¤í–‰ ì¤‘ì¸ **Process ê°ì²´**(ì´ë¦„, PID ë“±) ë°˜í™˜.
- **`os.getpid()`**: í˜„ì¬ OS í”„ë¡œì„¸ìŠ¤ **PID(ì •ìˆ˜)**.
- **`Process(target=..., args=(...,), kwargs={...}, name="...")`**: ìƒˆ í”„ë¡œì„¸ìŠ¤ **ìƒì„±ì**.  
  - `target`: ìì‹ì—ì„œ ì‹¤í–‰í•  **í•¨ìˆ˜**  
  - `args/kwargs`: í•´ë‹¹ í•¨ìˆ˜ì— ë„˜ê¸¸ ì¸ì  
  - `name`: ë””ë²„ê¹…/ë¡œê·¸ìš© ì‹ë³„ ì´ë¦„
- **`start()`**: ìì‹ **ì‹¤í–‰ ê°œì‹œ(í•„ìˆ˜)**.  
- **`join()`**: ìì‹ì´ **ëë‚  ë•Œê¹Œì§€ ëŒ€ê¸°**. ë¯¸í˜¸ì¶œ ì‹œ ë¶€ëª¨ê°€ ë¨¼ì € ì¢…ë£Œë  ìˆ˜ ìˆê³ , ìì‹ ì •ë¦¬ íƒ€ì´ë° ì œì–´ê°€ ì–´ë µë‹¤.
- **`time.sleep(sec)`**: í•´ë‹¹ í”„ë¡œì„¸ìŠ¤ì˜ **ì‹¤í–‰ì„ ì ì‹œ ë©ˆì¶¤**(OS ìŠ¤ì¼€ì¤„ëŸ¬ì—ê²Œ CPU ì–‘ë³´).

### ğŸ‘€ ë¶€ëª¨ vs ìì‹ì˜ â€œì›€ì§ì„ ì°¨ì´â€
- **PID**: ë¶€ëª¨/ìì‹ **ì„œë¡œ ë‹¤ë¦„** â†’ OSê°€ ë‹¤ë¥¸ ì‘ì—…ìœ¼ë¡œ ì·¨ê¸‰.
- **ë©”ëª¨ë¦¬**: ë¶€ëª¨ì˜ ê°ì²´ ë³€ê²½ì´ ìì‹ì—ê²Œ **ìë™ ì „íŒŒë˜ì§€ ì•ŠìŒ**. ë°ì´í„° êµí™˜ì€ **íŒŒì´í”„/í/ê³µìœ ë©”ëª¨ë¦¬** í•„ìš”.
- **ìŠ¤ì¼€ì¤„ë§**: OSê°€ **ë³‘ë ¬**ë¡œ ì‹¤í–‰ ê°€ëŠ¥(ì½”ì–´ê°€ ì—¬ëŸ¿ì¼ ë•Œ).

---

<a id="sec-4"></a>
## 4. ìŠ¤ë ˆë“œ: ì‹¤íƒ€ë˜ ë¹„ìœ , ì¥ë‹¨ì Â·í•œê³„, `_`(ì–¸ë”ìŠ¤ì½”ì–´) ì˜ë¯¸

### ğŸ“Œ ì‹¤ìŠµ ì½”ë“œ (ê³µìœ  ë”•ì…”ë„ˆë¦¬ ì¹´ìš´íŒ…)
```python
import threading

shared = {"count": 0}

def worker(n):
    for _ in range(100_000):     # _ : ê°’ì„ ì“°ì§€ ì•Šì„ ë£¨í”„ ë³€ìˆ˜(ê´€ìš©ì  ì´ë¦„)
        shared["count"] += 1
    print(f"[worker {n}] done")

ts = [threading.Thread(target=worker, args=(i,)) for i in range(4)]
[t.start() for t in ts]
[t.join() for t in ts]

print("shared count:", shared["count"])
```

### ğŸ¯ í•™ìŠµ í¬ì¸íŠ¸
- **ìŠ¤ë ˆë“œ = í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ ì•ˆì˜ ì—¬ëŸ¬ ì‹¤í–‰ íë¦„** (ì£¼ì†Œê³µê°„ ê³µìœ ).
- ì¥ì : **ê³µìœ  ë©”ëª¨ë¦¬ë¡œ í†µì‹ ì´ ë¹ ë¦„**, ìƒì„±/ì „í™˜ ë¹„ìš©ì´ í”„ë¡œì„¸ìŠ¤ë³´ë‹¤ ì €ë ´.
- í•œê³„: **ê²½ìŸ ì¡°ê±´**(race), **ë°ë“œë½**, **GILë¡œ ì¸í•œ CPU ì‘ì—… ë³‘ë ¬ì„± í•œê³„(CPython)**.

### ğŸ“– ìƒì„¸ ì„¤ëª…
- **ì¥ì **
  - ê°™ì€ í”„ë¡œì„¸ìŠ¤ì˜ **í™**ì„ ê³µìœ  â†’ ê°ì²´ ì „ë‹¬ì´ **ì°¸ì¡°ë§Œìœ¼ë¡œ** ê°€ëŠ¥.
  - I/O-bound ì‘ì—…ì— íŠ¹íˆ ìœ ë¦¬(ëŒ€ê¸° ì¤‘ ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ì¼í•¨).
- **í•œê³„/ì£¼ì˜**
  - **GIL** ë•Œë¬¸ì— CPythonì—ì„œ **CPU-bound**ëŠ” ë©€í‹°ìŠ¤ë ˆë“œ ì´ë“ì´ ì‘ìŒ(6ë²ˆ ì°¸ê³ ).
  - ê³µìœ  ë°ì´í„°ì— **ë™ì‹œ ì ‘ê·¼**í•˜ë©´ ìˆœì„œ/ì¼ê´€ì„±ì´ ê¹¨ì§ˆ ìˆ˜ ìˆìŒ â†’ Lock ë“± ë™ê¸°í™” í•„ìˆ˜(8ë²ˆ ì°¸ê³ ).
- **`_` ì–¸ë”ìŠ¤ì½”ì–´**: â€œì´ ë³€ìˆ˜ëŠ” ì“°ì§€ ì•Šì„ ê²ƒâ€ì´ë¼ëŠ” **ê´€ìš©ì  ì´ë¦„**ì¼ ë¿, íŒŒì´ì¬ ë¬¸ë²• í‚¤ì›Œë“œëŠ” ì•„ë‹˜.  
  - ë£¨í”„ ì¸ë±ìŠ¤ë¥¼ ì“°ì§€ ì•Šì„ ë•Œ `for _ in range(n)` ì²˜ëŸ¼ ì‚¬ìš©.

---

<a id="sec-5"></a>
## 5. ìŠ¤íƒ í”„ë ˆì„ vs í™: ë¬´ì—‡ì´ ê³µìœ ë˜ê³  ë¬´ì—‡ì´ ë¶„ë¦¬ë˜ëŠ”ê°€

### ğŸ“Œ ì‹¤ìŠµ ì½”ë“œ (ì „ì—­ ë¦¬ìŠ¤íŠ¸ì— ë‹¤ì¤‘ ìŠ¤ë ˆë“œê°€ push)
```python
import threading
global_list = []

def push_many(tag):
    local_count = 0                  # â† ê° ìŠ¤ë ˆë“œì˜ "ìŠ¤íƒ í”„ë ˆì„(ë¡œì»¬)"ì— ì¡´ì¬
    for _ in range(100_000):
        global_list.append((tag, local_count))  # â† í”„ë¡œì„¸ìŠ¤ í™(ê³µìœ  ê°ì²´) ì¡°ì‘
        local_count += 1
    print(f"[{tag}] pushed {local_count}")

t1 = threading.Thread(target=push_many, args=("A",))
t2 = threading.Thread(target=push_many, args=("B",))
t1.start(); t2.start()
t1.join(); t2.join()
```

### ğŸ¯ í•™ìŠµ í¬ì¸íŠ¸
- **ìŠ¤íƒ í”„ë ˆì„(ë¡œì»¬ ë³€ìˆ˜)**: ìŠ¤ë ˆë“œë§ˆë‹¤ **ë¶„ë¦¬**. (í•¨ìˆ˜ í˜¸ì¶œ ì»¨í…ìŠ¤íŠ¸)
- **í™(ê°ì²´ ì €ì¥ì†Œ)**: **í”„ë¡œì„¸ìŠ¤ ë‹¨ìœ„ë¡œ ê³µìœ **. ëª¨ë“  ìŠ¤ë ˆë“œê°€ ì ‘ê·¼ ê°€ëŠ¥.

### ğŸ“– ìƒì„¸ ì„¤ëª…
- CPythonì—ì„œ **ë¡œì»¬ ë³€ìˆ˜**ëŠ” ê° ìŠ¤ë ˆë“œì˜ **í”„ë ˆì„ ê°ì²´**ì— ì €ì¥ë˜ì–´ ì„œë¡œ ì„ì´ì§€ ì•ŠìŒ.
- ë¦¬ìŠ¤íŠ¸/ë”•ì…”ë„ˆë¦¬/ì‚¬ìš©ì ê°ì²´ ë“±ì€ **í™(ê³µìœ )** ì— ìˆìŒ â†’ ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ ê°™ì€ ê°ì²´ë¥¼ ë°”ë¼ë³¸ë‹¤.
- ìœ„ ì˜ˆì œì˜ `list.append`ëŠ” CPython C ë ˆë²¨ì—ì„œ **ì›ìì„± ë³´ì¥ë˜ëŠ” í¸**ì´ë¼ ë³´í†µ ì¶©ëŒë¡œ ë§ê°€ì§€ì§„ ì•Šì§€ë§Œ,  
  **ë³µí•© ì—°ì‚°**(ì½ê³ -ìˆ˜ì •í•˜ê³ -ì“°ëŠ” ì—°ì† ë™ì‘)ì€ **ë½ ì—†ì´** í•˜ë©´ ì‰½ê²Œ ë ˆì´ìŠ¤ê°€ ë‚œë‹¤.  
  (ì˜ˆ: `x = x + 1` ì€ ì›ìì ì´ì§€ ì•ŠìŒ. 8ë²ˆì—ì„œ ìì„¸íˆ)

---

<a id="sec-6"></a>
## 6. CPU-bound vs I/O-bound, Executors, asyncio, GIL, ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­

### ğŸ“Œ ë³´ì •/í™•ì¥ëœ ë²¤ì¹˜ ì½”ë“œ
```python
import time
from concurrent.futures import ThreadPoolExecutor, ProcessPoolExecutor

def cpu_heavy(n: int) -> int:
    # ì—°ì‚°ëŸ‰ í° ì‘ì—… (CPU-bound)
    return sum(i*i for i in range(n))

def io_heavy(t: float) -> float:
    # I/O ëŒ€ê¸° (time.sleepë¡œ ì‹œë®¬ë ˆì´ì…˜) â†’ ëŒ€ê¸° ì¤‘ GIL í•´ì œ
    time.sleep(t)
    return t

def bench_cpu_with_processes(sizes):
    start = time.perf_counter()
    with ProcessPoolExecutor(max_workers=4) as ex:
        list(ex.map(cpu_heavy, sizes))
    return time.perf_counter() - start

def bench_cpu_with_threads(sizes):
    start = time.perf_counter()
    with ThreadPoolExecutor(max_workers=4) as ex:
        list(ex.map(cpu_heavy, sizes))
    return time.perf_counter() - start

def bench_io_with_threads(delays):
    start = time.perf_counter()
    with ThreadPoolExecutor(max_workers=4) as ex:
        list(ex.map(io_heavy, delays))
    return time.perf_counter() - start

def bench_io_with_processes(delays):
    start = time.perf_counter()
    with ProcessPoolExecutor(max_workers=4) as ex:
        list(ex.map(io_heavy, delays))
    return time.perf_counter() - start

if __name__ == "__main__":
    sizes  = [10**6]*4
    delays = [1.0]*4

    print("CPU (processes):", bench_cpu_with_processes(sizes), "s")
    print("CPU (threads)  :", bench_cpu_with_threads(sizes),   "s")
    print("IO  (threads)  :", bench_io_with_threads(delays),   "s")
    print("IO  (processes):", bench_io_with_processes(delays), "s")
```

### ğŸ¯ í•™ìŠµ í¬ì¸íŠ¸
- **CPU-bound**: ì—°ì‚°ì´ ë³‘ëª© â†’ **ProcessPool**ë¡œ ì½”ì–´ ë³‘ë ¬ í™œìš©(GIL íšŒí”¼).
- **I/O-bound**: ëŒ€ê¸°ê°€ ë³‘ëª© â†’ **ThreadPool** ìœ ë¦¬(ëŒ€ê¸° ì¤‘ GIL í•´ì œë¡œ ë™ì‹œì„±â†‘).
- **ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­**: ì‹¤í–‰ ì£¼ì²´ ì „í™˜ ë¹„ìš©(ìŠ¤ë ˆë“œ < í”„ë¡œì„¸ìŠ¤). ë„ˆë¬´ ìì£¼ ë°œìƒí•˜ë©´ ëŠë ¤ì§(7ë²ˆ ì°¸ê³ ).

### ğŸ“– ìš©ì–´Â·API ì„¤ëª…
- **`concurrent.futures`**: ê³ ìˆ˜ì¤€ í’€ API. `ThreadPoolExecutor`, `ProcessPoolExecutor` ì œê³µ.
- **`max_workers`**: í’€ì˜ ìµœëŒ€ ì‘ì—…ì ìˆ˜. ê³¼ë„í•˜ê²Œ í¬ë©´ ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­/ìŠ¤ì¼€ì¤„ë§ ì˜¤ë²„í—¤ë“œâ†‘.
- **`time.perf_counter()`**: **ëª¨ë…¸í† ë‹‰ ê³ í•´ìƒë„ íƒ€ì´ë¨¸**. ê²½ê³¼ ì‹œê°„ ì¸¡ì •ì— ê¶Œì¥.
- **GIL(Global Interpreter Lock)**: CPythonì—ì„œ **í•œ ë²ˆì— í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë§Œ ë°”ì´íŠ¸ì½”ë“œ ì‹¤í–‰** ê°€ëŠ¥í•˜ê²Œ í•˜ëŠ” ì „ì—­ ì ê¸ˆ.  
  ë‹¨, **ë¸”ë¡œí‚¹ I/O êµ¬ê°„**ê³¼ ì¼ë¶€ C í™•ì¥ ëª¨ë“ˆì€ **GILì„ í•´ì œ**í•˜ì—¬ ë™ì‹œì„± í™•ë³´.
- **`asyncio`**: **í˜‘ë ¥í˜• ì½”ë£¨í‹´** ê¸°ë°˜ ë™ì‹œì„±. `await` ì§€ì ì—ì„œ ì œì–´ ì–‘ë³´. CPU-boundì—ëŠ” ë¶€ì í•©, **ëŒ€ê·œëª¨ I/O**ì— ì í•©.

> ì‹¤ë¬´ íŒ: â€œCPUëŠ” í”„ë¡œì„¸ìŠ¤, I/OëŠ” ìŠ¤ë ˆë“œ/asyncioâ€ ë¥¼ 1ì°¨ ì„ íƒì§€ë¡œ ì‚¼ê³ , **í”„ë¡œíŒŒì¼ë§**ìœ¼ë¡œ ê²€ì¦.

---

<a id="sec-7"></a>
## 7. ì‘ì—…ì„ ë„ˆë¬´ ì˜ê²Œ ìª¼ê°œë©´ ì™œ ëŠë ¤ì§€ë‚˜ (ì˜¤ë²„í—¤ë“œ, ëŒ€ì•ˆ ì „ëµ)

### ğŸ“Œ ë³´ì •ëœ ì‹¤ìŠµ ì½”ë“œ (ì‘ì€ ì‘ì—… vs ë°°ì¹˜)
```python
import time
from concurrent.futures import ThreadPoolExecutor

def tiny_work(_) -> int:
    # ì•„ì£¼ ì‘ì€ ì¼ (ì˜¤ë²„í—¤ë“œê°€ ìƒëŒ€ì ìœ¼ë¡œ í¼)
    return 1

def batched_work(batch_size: int) -> int:
    # ì‘ì€ ì¼ì„ ë¬¶ì–´ì„œ í•œ ì“°ë ˆë“œê°€ í•œ ë²ˆì— ì²˜ë¦¬
    s = 0
    for _ in range(batch_size):
        s += 1
    return s

if __name__ == "__main__":
    N = 100_000

    # 1) ì‘ì€ ì‘ì—… Nê°œë¥¼ ê·¸ëŒ€ë¡œ ìŠ¤ë ˆë“œí’€ì— ë˜ì§
    start = time.perf_counter()
    with ThreadPoolExecutor(max_workers=100) as ex:
        list(ex.map(tiny_work, range(N)))
    t_tiny = time.perf_counter() - start
    print("tiny tasks individually:", t_tiny, "s")

    # 2) ì‘ì€ ì‘ì—…ì„ ë¬¶ì–´ì„œ(ë°°ì¹˜) ê°œìˆ˜ë¥¼ ì¤„ì„
    batch = 100
    start = time.perf_counter()
    with ThreadPoolExecutor(max_workers=100) as ex:
        list(ex.map(batched_work, [batch]*(N//batch)))
    t_batch = time.perf_counter() - start
    print("batched tasks:", t_batch, "s")
```

### ğŸ¯ í•™ìŠµ í¬ì¸íŠ¸
- **ì‘ì€ ì‘ì—… ê°œìˆ˜ê°€ ë„ˆë¬´ ë§ìœ¼ë©´** ìŠ¤ì¼€ì¤„ë§/íì‰/ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­/í“¨ì²˜ ê´€ë¦¬ **ì˜¤ë²„í—¤ë“œ**ê°€ ì§€ë°°.
- **ë°°ì¹˜(batch)** ë¡œ ë¬¶ê±°ë‚˜, **ë²¡í„°í™”/ì¼ê´„ ì²˜ë¦¬**ë¡œ í˜¸ì¶œ íšŸìˆ˜ë¥¼ ì¤„ì´ë©´ ì„±ëŠ¥ì´ í¬ê²Œ ë‚˜ì•„ì§„ë‹¤.

### ğŸ“– ì™œ ëŠë ¤ì§€ë‚˜?
- **í í‘¸ì‹œ/íŒ + ì ê¸ˆ ë¹„ìš©** (ìŠ¤ë ˆë“œí’€ ë‚´ë¶€ êµ¬í˜„).
- **ì‘ì—…ì ê¹¨ìš°ê¸°/ì»¨í…ìŠ¤íŠ¸ ìŠ¤ìœ„ì¹­**.
- **í•¨ìˆ˜ í˜¸ì¶œ/íŒŒì´ì¬ í”„ë ˆì„ ìƒì„±/ì†Œë©¸** ë¹„ìš©ì´ **ì‘ì—… ìì²´ë³´ë‹¤ ì»¤ì§**.

---

<a id="sec-8"></a>
## 8. ì„ê³„êµ¬ì—­ê³¼ Lock: race vs safe, `with lock`ì˜ ì‹¤ì œ ë™ì‘

### ğŸ“Œ ì‹¤ìŠµ ì½”ë“œ (ê²½ìŸ ì¡°ê±´ ì¬í˜„ â†’ Lockìœ¼ë¡œ í•´ê²°)
```python
import threading

N = 100_000
count = 0
lock = threading.Lock()

def race():
    global count
    for _ in range(N):
        # ë¹„ì›ìì (Load â†’ Add â†’ Store)ì´ë¼ ì¤‘ê°„ì— ìŠ¤ìœ„ì¹­ë˜ë©´ ê¼¬ì„
        count += 1

def safe():
    global count
    for _ in range(N):
        with lock:      # __enter__ ì‹œ lock.acquire(), __exit__ ì‹œ lock.release()
            count += 1

# 1) ë ˆì´ìŠ¤ (ë½ ì—†ìŒ)
count = 0
ts = [threading.Thread(target=race) for _ in range(4)]
[t.start() for t in ts]; [t.join() for t in ts]
print("race result (unsafe):", count)

# 2) ì•ˆì „ (ë½ ì‚¬ìš©)
count = 0
ts = [threading.Thread(target=safe) for _ in range(4)]
[t.start() for t in ts]; [t.join() for t in ts]
print("safe result (with lock):", count)
```

### ğŸ¯ í•™ìŠµ í¬ì¸íŠ¸
- **ì„ê³„êµ¬ì—­**: ì—¬ëŸ¬ ìŠ¤ë ˆë“œê°€ **ë™ì‹œì—** ë“¤ì–´ì˜¤ë©´ **ë¶ˆì¼ì¹˜/ê¹¨ì§**ì´ ë°œìƒí•˜ëŠ” ì½”ë“œ ì˜ì—­.
- `threading.Lock()` ìœ¼ë¡œ **ì„œë¡œ ë°°íƒ€ì **ìœ¼ë¡œ ì‹¤í–‰ë˜ê²Œ ë§Œë“¤ì–´ ì¼ê´€ì„±ì„ ë³´ì¥.

### ğŸ“– ìƒì„¸ ì„¤ëª…
- `count += 1` ì€ ë°”ì´íŠ¸ì½”ë“œë¡œ **ì—¬ëŸ¬ ë‹¨ê³„**ë¡œ ë‚˜ë‰˜ë©° **ì›ìì ì´ì§€ ì•Šë‹¤**.  
  â†’ GILì´ ìˆì–´ë„ **ë°”ì´íŠ¸ì½”ë“œ ì‚¬ì´ì— ìŠ¤ìœ„ì¹­**ì´ ì¼ì–´ë‚˜ë©´ ê°’ì´ ìœ ì‹¤.
- **`with lock:`** ëŠ” ì»¨í…ìŠ¤íŠ¸ ë§¤ë‹ˆì € í”„ë¡œí† ì½œ:  
  - ì§„ì… ì‹œ `lock.acquire()`  
  - ë¸”ë¡ ì¢…ë£Œ(ì •ìƒ/ì˜ˆì™¸) ì‹œ **ë°˜ë“œì‹œ** `lock.release()`  
- ìƒí™©ì— ë”°ë¼ `RLock`(ì¬ê·€ ë½), `Semaphore`, `Condition` ë“± ê³ ê¸‰ ë™ê¸°í™” ë„êµ¬ë¥¼ ì‚¬ìš©.

---

<a id="sec-9"></a>
## 9. GILì€ ì–¸ì œ/ì™œ í•´ì œë˜ëŠ”ê°€: `time.sleep`ì´ ì£¼ëŠ” íš¨ê³¼

### ğŸ“Œ ì‹¤ìŠµ ì½”ë“œ (I/O ëŒ€ê¸°ì—ì„œ GIL í•´ì œ ì²´ê°)
```python
import time
from concurrent.futures import ThreadPoolExecutor

def io_task(t: float) -> float:
    time.sleep(t)   # ë¸”ë¡œí‚¹ í˜¸ì¶œ ë™ì•ˆ C ë ˆë²¨ì—ì„œ GILì„ í’€ê³  ëŒ€ê¸°
    return t

if __name__ == "__main__":
    delays = [0.5, 0.5, 0.5, 0.5]
    start = time.perf_counter()
    with ThreadPoolExecutor(max_workers=4) as ex:
        list(ex.map(io_task, delays))
    print("I/O tasks with threads:", time.perf_counter() - start, "s")
```

### ğŸ¯ í•™ìŠµ í¬ì¸íŠ¸
- **GIL(Global Interpreter Lock)**: CPython ì¸í„°í”„ë¦¬í„°ê°€ **ë™ì‹œì— í•˜ë‚˜ì˜ ìŠ¤ë ˆë“œë§Œ** ë°”ì´íŠ¸ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë„ë¡ ë³´ì¥í•˜ëŠ” ì „ì—­ ë½.
- í•˜ì§€ë§Œ **ë¸”ë¡œí‚¹ I/O**(ì˜ˆ: `time.sleep`, ì†Œì¼“/íŒŒì¼ I/O) êµ¬ê°„ì—ì„œ CPython C ì½”ë“œê°€ **GILì„ í•´ì œ**(`Py_BEGIN_ALLOW_THREADS`)í•˜ë¯€ë¡œ,  
  **ë‹¤ë¥¸ ìŠ¤ë ˆë“œê°€ ì‹¤í–‰**ë  ìˆ˜ ìˆë‹¤ â†’ I/O-boundì— ìŠ¤ë ˆë“œê°€ ìœ ë¦¬.

### ğŸ“– ìƒì„¸ ì„¤ëª…
- **í•´ì œë˜ëŠ” ê²½ìš°**:  
  - `time.sleep()`, íŒŒì¼/ì†Œì¼“ I/O, ì¼ë¶€ C í™•ì¥(NumPyì˜ ëŒ€í˜• ì—°ì‚° ë“±)ì´ ë‚´ë¶€ì ìœ¼ë¡œ GILì„ ì ì‹œ í’€ê³  ëŒ€ê¸°/ê³„ì‚°.  
- **CPU-bound**ëŠ”?  
  - íŒŒì´ì¬ ìˆœìˆ˜ ì—°ì‚°ì€ ëŒ€ë¶€ë¶„ GILì„ ì¥” ì±„ ì‹¤í–‰ â†’ ìŠ¤ë ˆë“œ ë³‘ë ¬ì„± ì´ë“ ì‘ìŒ.  
  - í•´ê²°ì±…: **multiprocessing**(í”„ë¡œì„¸ìŠ¤ ë¶„ë¦¬) ë˜ëŠ” **C í™•ì¥/NumPy**ë¡œ GIL ë°”ê¹¥ì—ì„œ ê³„ì‚°.

---

## ë¶€ë¡) ìì£¼ ì–¸ê¸‰ëœ ëª¨ë“ˆ/í•¨ìˆ˜ í•œëˆˆì—
- **`sys.settrace(fn)`**: ì¤„ ì‹¤í–‰/í˜¸ì¶œ/ì˜ˆì™¸ ì´ë²¤íŠ¸ë¥¼ í›„í‚¹. (ë””ë²„ê¹…Â·ì»¤ë²„ë¦¬ì§€ ê¸°ë°˜)
- **`linecache.getline(path, n)`**: íŒŒì¼ì˜ në²ˆì§¸ ì¤„ì„ ìºì‹œì—ì„œ ì½ìŒ.
- **`os.getpid()`**: í˜„ì¬ í”„ë¡œì„¸ìŠ¤ PID.
- **`multiprocessing.current_process()`**: í˜„ì¬ í”„ë¡œì„¸ìŠ¤ ê°ì²´(ì´ë¦„/PID).
- **`Process(target, args, kwargs, name)`**: ìƒˆ í”„ë¡œì„¸ìŠ¤ ìƒì„±ì.
- **`Thread(target, args, kwargs, name)`**: ìƒˆ ìŠ¤ë ˆë“œ ìƒì„±ì.
- **`start()/join()`**: ì‹¤í–‰ ì‹œì‘/ì¢…ë£Œ ëŒ€ê¸°(ë™ê¸°í™”).
- **`ThreadPoolExecutor/ProcessPoolExecutor`**: ìŠ¤ë ˆë“œ/í”„ë¡œì„¸ìŠ¤ í’€. `max_workers`ë¡œ ë³‘ë ¬ë„ ì œì–´.
- **`time.perf_counter()`**: ê²½ê³¼ ì‹œê°„ ì¸¡ì •ìš© ê³ í•´ìƒë„ íƒ€ì´ë¨¸.
- **`threading.Lock()`**: ìƒí˜¸ë°°ì œ ë½. `with lock:` ìœ¼ë¡œ ì•ˆì „í•˜ê²Œ ì‚¬ìš©.
